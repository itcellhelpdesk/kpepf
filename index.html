<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPEPF Schedule View | District Treasury</title>
    <!-- Bootstrap & DataTables CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- jQuery, Bootstrap, DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    
    <style>
        body {
            background-color: #d7e2ff6e;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
        }
        
        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
        }
        
        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:disabled {
            background: #cccccc;
            transform: none;
            box-shadow: none;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .table td {
            vertical-align: middle;
        }
        
        .receipt-badge {
            background-color: #198754;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .payment-badge {
            background-color: #dc3545;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .total-row {
            background-color: #e9ecef !important;
            font-weight: bold;
        }
        
        .total-amount {
            color: #198754;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .confirmed-badge {
            background-color: #0d6efd;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .unconfirmed-badge {
            background-color: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .month-year-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .section-header {
            background-color: #e9ecef;
            padding: 12px 15px;
            border-radius: 6px;
            margin: 20px 0 10px;
            border-left: 4px solid #28a745;
            font-weight: 600;
            color: #495057;
        }
        
        .dt-schedule-header {
            background-color: #e9ecef;
            padding: 12px 15px;
            border-radius: 6px;
            margin: 20px 0 10px;
            border-left: 4px solid #ffc107;
            font-weight: 600;
            color: #495057;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="bi bi-check-circle"></i> KPEPF Schedule Receipts & Payment Details</h4>
            </div>
            
            <div class="card-body">
                <!-- Filter Section -->
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <label class="form-label">District Treasury</label>
                        <select class="form-select" id="district" required>
                            <option value="">Select District</option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label class="form-label">Month</label>
                        <select class="form-select" id="month">
                            <option value="">Select</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-control" id="year" placeholder="(YYYY format)">
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">Type</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="typeReceipt" name="type" value="Receipt" checked>
                                <label for="typeReceipt">Receipt</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="typePayment" name="type" value="Payment">
                                <label for="typePayment">Payment</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-2 d-flex align-items-end">
                        <button class="btn btn-primary w-100" onclick="viewConfirmedData()">
                            <i class="bi bi-eye"></i> View Data
                        </button>
                    </div>
                </div>
                
                <!-- Loading Spinner -->
                <div id="loadingSection" class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading data. Please wait...</p>
                </div>
                
                <!-- Results Section -->
                <div id="resultsSection" style="display: none;">
                    <div class="month-year-display">
                        <div class="result-header">
                            <h5 id="resultHeading" style="color: #667eea; margin: 0;"></h5>
                        </div>
                        <div id="summaryInfo" class="mt-2"></div>
                    </div>
                    
                    <!-- Receipt Schedules Section -->
                    <div class="section-header">
                        <i class="bi bi-check-circle-fill text-success"></i> All Treasury Schedules 
                    </div>
                    
                    <div class="table-responsive mb-4">
                        <table id="receiptScheduleTable" class="table table-hover table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Treasury</th>
                                    <th>Type</th>
                                    <th>Month</th>
                                    <th>Year</th>
                                    <th>Gross Total</th>
                                    <th>Document</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="receiptScheduleTableBody">
                                <!-- Receipt schedule data will be inserted here -->
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="5" class="text-end fw-bold">Schedule Total:</td>
                                    <td id="receiptScheduleGrandTotal" class="total-amount">0.00</td>
                                    <td colspan="2"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <!-- DT- Schedule Details Section -->
                    <div class="dt-schedule-header">
                        <i class="bi bi-list-check text-warning"></i> DT- Schedule 
                    </div>
                    
                    <div class="table-responsive">
                        <table id="dtScheduleTable" class="table table-hover table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Treasury</th>
                                    <th>Type</th>
                                    <th>Month</th>
                                    <th>Year</th>
                                    <th>Gross Total</th>
                                    <th>Document</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dtScheduleTableBody">
                                <!-- DTresponse data will be inserted here -->
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="5" class="text-end fw-bold">DT-Schedule Total:</td>
                                    <td id="dtScheduleGrandTotal" class="total-amount">0.00</td>
                                    <td colspan="2"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- No Results -->
                <div id="noResultsSection" class="text-center py-5" style="display: none;">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle fs-4"></i>
                        <h5 class="mt-2">No Records Found</h5>
                        <p>No records match your filter criteria. Try different filters.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let allDistricts = [];
        let receiptScheduleData = [];
        let dtScheduleData = [];
        let receiptScheduleTable = null;
        let dtScheduleTable = null;
        const API_KEY = "AIzaSyBAuS3Brpsw5JOJnjNJii1UlFa7ClXf8d4";
        const SHEET_ID = "1J3hQtpZv4zyCUVANURf9B4lhORp2_ml-XlIWLZWR3aA";
        
        // Initialize when page loads
        $(document).ready(function() {
            console.log("KPEPF Data View application loaded");
            loadDistricts();
            
            // Set current year as default
            const currentYear = new Date().getFullYear();
            $('#year').val(currentYear);
            
            // Set Receipt as default selection
            $('#typeReceipt').prop('checked', true);
        });
        
        // Load districts from Google Sheets
        function loadDistricts() {
            $('#loadingSection').show();
            
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Treasuries!A:B?key=${API_KEY}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    $('#loadingSection').hide();
                    
                    if (data.values && data.values.length > 1) {
                        // Extract unique districts from column A (skip header)
                        const rows = data.values.slice(1);
                        const districtSet = new Set();
                        
                        rows.forEach(row => {
                            if (row[0] && row[0].trim()) {
                                districtSet.add(row[0].trim());
                            }
                        });
                        
                        allDistricts = Array.from(districtSet).sort();
                        
                        const select = $('#district');
                        allDistricts.forEach(district => {
                            select.append(new Option(district, district));
                        });
                        
                        console.log("Districts loaded:", allDistricts.length);
                    } else {
                        showMessage('No district data found in Treasuries sheet.', 'danger');
                    }
                })
                .catch(error => {
                    $('#loadingSection').hide();
                    console.error("Error loading districts:", error);
                    showMessage('Error loading districts. Please refresh the page.', 'danger');
                });
        }
        
        // View data based on filters
        function viewConfirmedData() {
            const district = $('#district').val();
            const month = $('#month').val();
            const year = $('#year').val();
            const type = $('input[name="type"]:checked').val();
            
            if (!district) {
                showMessage('Please select a District Treasury.', 'warning');
                return;
            }
            
            // Validate year if provided
            if (year && !/^\d{4}$/.test(year)) {
                showMessage('Please enter a valid 4-digit year.', 'warning');
                return;
            }
            
            // Show loading
            $('#loadingSection').show();
            $('#resultsSection').hide();
            $('#noResultsSection').hide();
            
            // Destroy existing DataTables if they exist
            if (receiptScheduleTable) {
                receiptScheduleTable.destroy();
                receiptScheduleTable = null;
            }
            
            if (dtScheduleTable) {
                dtScheduleTable.destroy();
                dtScheduleTable = null;
            }
            
            console.log("Fetching data with filters:", { district, month, year, type });
            
            // Fetch data from both sheets
            const promises = [
                fetchDataFromSheet("response", district, month, year, type),
                fetchDataFromSheet("DTresponse", district, month, year, type)
            ];
            
            Promise.all(promises)
                .then(([receiptScheduleDataResult, dtScheduleDataResult]) => {
                    $('#loadingSection').hide();
                    
                    const totalRecords = receiptScheduleDataResult.length + dtScheduleDataResult.length;
                    
                    if (totalRecords > 0) {
                        displayData(receiptScheduleDataResult, dtScheduleDataResult, district, month, year, type);
                        $('#resultsSection').show();
                        $('#noResultsSection').hide();
                    } else {
                        $('#resultsSection').hide();
                        $('#noResultsSection').show();
                    }
                })
                .catch(error => {
                    $('#loadingSection').hide();
                    console.error("Error fetching data:", error);
                    showMessage('Error fetching data. Please try again.', 'danger');
                    $('#noResultsSection').show();
                });
        }
        
        // Fetch data from a specific sheet
        function fetchDataFromSheet(sheetName, district, month, year, type) {
            const range = `${sheetName}!A:I`; // Columns A to I
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;
            
            return fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.values && data.values.length > 1) {
                        return processSheetData(data.values, district, month, year, type, sheetName);
                    }
                    return [];
                })
                .catch(error => {
                    console.error(`Error fetching data from ${sheetName}:`, error);
                    return [];
                });
        }
        
        // Process data from a sheet
        function processSheetData(rows, district, month, year, type, sheetName) {
            // Extract headers
            const headers = rows[0];
            const dataRows = rows.slice(1);
            
            // Find column indices
            const colIndex = {
                timestamp: headers.indexOf("Timestamp"),
                district: headers.indexOf("Name of District Treasury"),
                treasury: headers.indexOf("Name of Treasury"),
                type: headers.indexOf("Type"),
                month: headers.indexOf("Month"),
                year: headers.indexOf("Year"),
                grossTotal: headers.indexOf("Gross total"),
                document: headers.indexOf("Document"),
                confirm: headers.indexOf("Confirm")
            };
            
            // If confirm column doesn't exist, set it to -1
            if (colIndex.confirm === -1) {
                colIndex.confirm = -1;
            }
            
            // Filter data
            return dataRows.filter(row => {
                // Check if district column exists
                if (colIndex.district === -1) {
                    return false;
                }
                
                const rowDistrict = row[colIndex.district] || '';
                const rowType = row[colIndex.type] || '';
                const rowMonth = row[colIndex.month] || '';
                const rowYear = row[colIndex.year] || '';
                const rowConfirm = colIndex.confirm !== -1 ? (row[colIndex.confirm] || '') : '';
                
                // Apply filters
                const matchesDistrict = rowDistrict.toString().trim() === district;
                const matchesType = rowType.toString().trim() === type;
                const matchesMonth = !month || rowMonth.toString().trim() === month;
                const matchesYear = !year || rowYear.toString().trim().replace(/^'/, '') === year;
                
                // For response sheet, only show confirmed records
                // For DTresponse sheet, show all records
                if (sheetName === "response") {
                    const isConfirmed = rowConfirm.toString().trim().toLowerCase() === 'yes';
                    return matchesDistrict && matchesType && matchesMonth && matchesYear && isConfirmed;
                } else {
                    return matchesDistrict && matchesType && matchesMonth && matchesYear;
                }
            });
        }
        
        // Display data in tables
        function displayData(receiptScheduleDataArray, dtScheduleDataArray, district, month, year, type) {
            // Store data globally
            receiptScheduleData = receiptScheduleDataArray;
            dtScheduleData = dtScheduleDataArray;
            
            // Display receipt schedule data (sorted by treasury ascending)
            displayReceiptScheduleData(receiptScheduleDataArray);
            
            // Display DT-Schedule data
            displayDTScheduleData(dtScheduleDataArray);
            
            // Update heading and summary
            updateHeading(district, month, year, type, receiptScheduleDataArray.length, dtScheduleDataArray.length);
            
            // Initialize DataTables
            initializeDataTables();
        }
        
        // Display receipt schedule data sorted by treasury ascending
        function displayReceiptScheduleData(data) {
            const tableBody = $('#receiptScheduleTableBody');
            tableBody.empty();
            
            let grandTotal = 0;
            
            if (data.length === 0) {
                const noDataRow = `<tr><td colspan="8" class="text-center text-muted">No records found</td></tr>`;
                tableBody.append(noDataRow);
            } else {
                // Sort data by Treasury column (index 2) in ascending order
                const sortedData = [...data].sort((a, b) => {
                    const treasuryA = (a[2] || '').toString().toLowerCase();
                    const treasuryB = (b[2] || '').toString().toLowerCase();
                    return treasuryA.localeCompare(treasuryB);
                });
                
                sortedData.forEach((row, index) => {
                    // Since we don't have headers in the filtered data, we need to parse based on position
                    const rowType = row[3] || ''; // Type column
                    const rowMonth = row[4] || ''; // Month column
                    const rowYear = row[5] || ''; // Year column
                    const rowGrossTotal = row[6] || '0'; // Gross total column
                    const rowTreasury = row[2] || ''; // Treasury column
                    const rowDocument = row[7] || ''; // Document column
                    
                    // Parse gross total (remove apostrophe if present)
                    const grossTotalStr = rowGrossTotal.toString().replace(/^'/, '');
                    const grossTotalNum = parseFloat(grossTotalStr) || 0;
                    grandTotal += grossTotalNum;
                    
                    // Format gross total for display
                    const formattedGrossTotal = grossTotalNum.toLocaleString('en-IN', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                    
                    // Format year (remove apostrophe if present)
                    const formattedYear = rowYear.toString().replace(/^'/, '');
                    
                    const rowHtml = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${escapeHtml(rowTreasury)}</td>
                            <td>
                                <span class="${rowType === 'Receipt' ? 'receipt-badge' : 'payment-badge'}">
                                    ${escapeHtml(rowType)}
                                </span>
                            </td>
                            <td>${escapeHtml(rowMonth)}</td>
                            <td>${escapeHtml(formattedYear)}</td>
                            <td class="text-end">${formattedGrossTotal}</td>
                            <td>
                                ${rowDocument ? 
                                    `<a href="${escapeHtml(rowDocument)}" target="_blank" 
                                        class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-file-pdf"></i> View
                                    </a>` : 
                                    '<span class="text-muted">No Document</span>'
                                }
                            </td>
                            <td>
                                <span class="confirmed-badge">
                                    <i class="bi bi-check"></i> Confirmed
                                </span>
                            </td>
                        </tr>
                    `;
                    
                    tableBody.append(rowHtml);
                });
            }
            
            // Update grand total
            const formattedGrandTotal = grandTotal.toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            $('#receiptScheduleGrandTotal').text(formattedGrandTotal);
        }
        
        // Display DT-Schedule data
        function displayDTScheduleData(data) {
            const tableBody = $('#dtScheduleTableBody');
            tableBody.empty();
            
            let grandTotal = 0;
            
            if (data.length === 0) {
                const noDataRow = `<tr><td colspan="8" class="text-center text-muted">No records found</td></tr>`;
                tableBody.append(noDataRow);
            } else {
                data.forEach((row, index) => {
                    // Since we don't have headers in the filtered data, we need to parse based on position
                    const rowType = row[3] || ''; // Type column
                    const rowMonth = row[4] || ''; // Month column
                    const rowYear = row[5] || ''; // Year column
                    const rowGrossTotal = row[6] || '0'; // Gross total column
                    const rowTreasury = row[2] || ''; // Treasury column
                    const rowDocument = row[7] || ''; // Document column
                    const rowConfirm = row[8] || ''; // Confirm column
                    
                    // Parse gross total (remove apostrophe if present)
                    const grossTotalStr = rowGrossTotal.toString().replace(/^'/, '');
                    const grossTotalNum = parseFloat(grossTotalStr) || 0;
                    grandTotal += grossTotalNum;
                    
                    // Format gross total for display
                    const formattedGrossTotal = grossTotalNum.toLocaleString('en-IN', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                    
                    // Format year (remove apostrophe if present)
                    const formattedYear = rowYear.toString().replace(/^'/, '');
                    
                    // Determine status badge
                    const isConfirmed = rowConfirm.toString().trim().toLowerCase() === 'yes';
                    const statusBadge = isConfirmed ? 
                        `<span class="confirmed-badge">
                            <i class="bi bi-check"></i> Confirmed
                        </span>` :
                        `<span class="unconfirmed-badge">
                            <i class="bi bi-clock"></i> Pending
                        </span>`;
                    
                    const rowHtml = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${escapeHtml(rowTreasury)}</td>
                            <td>
                                <span class="${rowType === 'Receipt' ? 'receipt-badge' : 'payment-badge'}">
                                    ${escapeHtml(rowType)}
                                </span>
                            </td>
                            <td>${escapeHtml(rowMonth)}</td>
                            <td>${escapeHtml(formattedYear)}</td>
                            <td class="text-end">${formattedGrossTotal}</td>
                            <td>
                                ${rowDocument ? 
                                    `<a href="${escapeHtml(rowDocument)}" target="_blank" 
                                        class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-file-pdf"></i> View
                                    </a>` : 
                                    '<span class="text-muted">No Document</span>'
                                }
                            </td>
                            <td>${statusBadge}</td>
                        </tr>
                    `;
                    
                    tableBody.append(rowHtml);
                });
            }
            
            // Update grand total
            const formattedGrandTotal = grandTotal.toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            $('#dtScheduleGrandTotal').text(formattedGrandTotal);
        }
        
        // Update heading and summary information
        function updateHeading(district, month, year, type, receiptScheduleCount, dtScheduleCount) {
            let heading = `${district} - Records Summary`;
            
            if (month) heading += ` | Month: ${month}`;
            if (year) heading += ` | Year: ${year}`;
            heading += ` | Type: ${type}`;
            
            $('#resultHeading').text(heading);
            
            // Update summary info
            const summary = `
                <div class="row">
                    <div class="col-md-2">
                        <strong>Receipt Schedules:</strong> ${receiptScheduleCount}
                    </div>
                    <div class="col-md-2">
                        <strong>DT-Schedule Records:</strong> ${dtScheduleCount}
                    </div>
                    <div class="col-md-2">
                        <strong>Total Records:</strong> ${receiptScheduleCount + dtScheduleCount}
                    </div>
                    <div class="col-md-3">
                        <strong>Type:</strong> ${type}
                    </div>
                    <div class="col-md-3">
                        <strong>Date:</strong> ${new Date().toLocaleDateString('en-IN')}
                    </div>
                </div>
            `;
            
            $('#summaryInfo').html(summary);
        }
        
        // Initialize DataTables
        function initializeDataTables() {
            // Initialize Receipt Schedules DataTable (sorted by Treasury column ascending by default)
            receiptScheduleTable = $('#receiptScheduleTable').DataTable({
                paging: true,
                pageLength: 10,
                lengthMenu: [[5, 10, 25, 50], [5, 10, 25, 50]],
                ordering: true,
                order: [[1, 'asc']], // Sort by Treasury column (index 1) ascending
                columnDefs: [
                    { orderable: false, targets: [0, 6, 7] } // Disable sorting for S.No, Document, and Status columns
                ],
                language: {
                    search: "Search:",
                    lengthMenu: "Show _MENU_ records",
                    info: "Showing _START_ to _END_ of _TOTAL_ records",
                    infoEmpty: "Showing 0 to 0 of 0 records",
                    infoFiltered: "(filtered from _MAX_ total records)",
                    zeroRecords: "No matching records found",
                    paginate: {
                        first: "First",
                        last: "Last",
                        next: "Next",
                        previous: "Previous"
                    }
                }
            });
            
            // Initialize DT-Schedule DataTable
            dtScheduleTable = $('#dtScheduleTable').DataTable({
                paging: true,
                pageLength: 10,
                lengthMenu: [[5, 10, 25, 50], [5, 10, 25, 50]],
                ordering: true,
                order: [[1, 'asc']], // Sort by Treasury column (index 1) ascending
                columnDefs: [
                    { orderable: false, targets: [0, 6, 7] } // Disable sorting for S.No, Document, and Status columns
                ],
                language: {
                    search: "Search:",
                    lengthMenu: "Show _MENU_ records",
                    info: "Showing _START_ to _END_ of _TOTAL_ records",
                    infoEmpty: "Showing 0 to 0 of 0 records",
                    infoFiltered: "(filtered from _MAX_ total records)",
                    zeroRecords: "No matching records found",
                    paginate: {
                        first: "First",
                        last: "Last",
                        next: "Next",
                        previous: "Previous"
                    }
                }
            });
        }
        
        // Show message
        function showMessage(message, type) {
            // Create alert element
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <i class="bi bi-info-circle"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Insert at top of card body
            const cardBody = document.querySelector('.card-body');
            cardBody.insertBefore(alertDiv, cardBody.firstChild);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    $(alertDiv).alert('close');
                }
            }, 5000);
        }
        
        // Helper function to escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text ? text.toString().replace(/[&<>"']/g, m => map[m]) : '';
        }
    </script>
</body>
</html>
